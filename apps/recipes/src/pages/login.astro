---
import RecipeLayout from '../layouts/RecipeLayout.astro'
import { GoogleSignInButton } from '../components/auth/GoogleSignInButton'
import { EmailLinkSignIn } from '../components/auth/EmailLinkSignIn'

// Server-side redirect if already logged in?
// The middleware usually handles protection, but we can double check.
const auth = Astro.cookies.get('site_auth')
const user = Astro.cookies.get('site_user')

let isAllowed = false

if (auth?.value === 'true' && user?.value) {
  // If cookies are present, we assume the user was authorized by the login API.
  isAllowed = true
}

if (isAllowed) {
  return Astro.redirect('/protected/recipes')
}
---

<RecipeLayout title="Login">
  <div class="flex flex-1 items-center justify-center p-4">
    <div
      class="border-md-sys-color-outline bg-md-sys-color-surface w-full max-w-md rounded-xl border p-8 shadow-md"
    >
      <div class="mb-8 text-center">
        <h1
          class="text-md-sys-color-on-surface mb-2 font-display text-4xl font-bold tracking-tight"
        >
          Chef Login
        </h1>
        <p class="text-md-sys-color-on-surface-variant">Manage your kitchen with AI</p>
      </div>

      <GoogleSignInButton client:only="react" />

      <div class="relative my-6">
        <div class="absolute inset-0 flex items-center">
          <span class="w-full border-t border-gray-300 dark:border-gray-600"></span>
        </div>
        <div class="relative flex justify-center text-sm">
          <span class="bg-white px-4 text-gray-500 dark:bg-zinc-800 dark:text-gray-400">
            or continue with email
          </span>
        </div>
      </div>

      <EmailLinkSignIn client:only="react" />
    </div>
  </div>
</RecipeLayout>
