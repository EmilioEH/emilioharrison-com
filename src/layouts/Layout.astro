---
import Navbar from '../components/layout/Navbar';

import { THEMES } from '../lib/themes';

// We can't easily access the store state on the server for initial render without some work,
// but for now we'll default to 'default' and let the client hydrate.
// To avoid flash of wrong theme, we might need a script.
// For this migration, we'll start with a basic setup.

const { title = "Emilio Harrison" } = Astro.props;
---

<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="UTF-8" />
		<meta name="description" content="Astro description">
		<meta name="viewport" content="width=device-width" />
		<link rel="icon" type="image/svg+xml" href="/favicon.svg" />
		<meta name="generator" content={Astro.generator} />
		<title>{title}</title>
	</head>
	<body>
        <!-- Theme wrapper script to avoid FOUC could go here, but relying on client hydration for now -->
        <div id="theme-wrapper" class="min-h-screen transition-colors duration-500 overflow-hidden relative">
            <Navbar client:load />
            
            <main class="max-w-6xl mx-auto px-4 md:px-8 py-12 min-h-[60vh] relative z-10">
                <slot />
            </main>

            <!-- NewsletterSignup needs to be updated to use store or passed theme -->
            <!-- For now, we'll comment it out or need to refactor it to use the store too -->
            <!-- <NewsletterSignup client:visible /> -->
            
            <footer class="bg-black text-white py-12 px-4 text-center relative z-10">
                <div class="font-bold text-2xl tracking-tighter mb-4">EMILIOHARRISON.COM</div>
                <p class="text-gray-500 text-sm">Â© {new Date().getFullYear()} Emilio Harrison. Built with Astro, React & Tailwind.</p>
            </footer>
        </div>

        <script>
            import { themeId } from '../lib/store';
            import { THEMES } from '../lib/themes';

            const wrapper = document.getElementById('theme-wrapper');
            const bgLayer = document.createElement('div');
            bgLayer.className = "fixed inset-0 pointer-events-none opacity-10 z-0";
            bgLayer.style.backgroundImage = 'linear-gradient(#4db8ff 1px, transparent 1px), linear-gradient(90deg, #4db8ff 1px, transparent 1px)';
            bgLayer.style.backgroundSize = '40px 40px';
            
            // Subscribe to theme changes to update the wrapper class
            themeId.subscribe(id => {
                const theme = THEMES[id];
                if (wrapper) {
                    wrapper.className = `min-h-screen ${theme.colors.bg} ${theme.colors.text} ${theme.font} transition-colors duration-500 overflow-hidden relative`;
                    
                    // Handle blueprint background
                    if (id === 'blueprint') {
                        if (!wrapper.contains(bgLayer)) wrapper.appendChild(bgLayer);
                    } else {
                        if (wrapper.contains(bgLayer)) wrapper.removeChild(bgLayer);
                    }
                }
            });
        </script>
	</body>
</html>
